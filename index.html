<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Oasis CRM</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <header class="topbar">
    <div class="brand">
      <div class="logo">OA</div>
      <div class="brandText">
        <div class="brandTitle">Oasis CRM</div>
        <div class="brandSub">Clientes · Historial · Seguimiento</div>
      </div>
    </div>

    <nav class="tabs" id="mainTabs">
      <button class="tab is-active" data-view="clients">Clientes</button>
      <button class="tab" data-view="timeline">Timeline</button>
      <button class="tab" data-view="reporting">Reporte</button>
      <button class="tab" data-view="settings">Config</button>
    </nav>

    <div class="topActions">
      <button class="btn ghost" id="btnExport" type="button">Export</button>
      <button class="btn ghost" id="btnImport" type="button">Import</button>
      <input id="importFile" type="file" accept="application/json" hidden />
      <button class="btn" id="btnNewClient" type="button">+ Cliente</button>
    </div>
  </header>

  <main class="wrap">

    <!-- CLIENTES -->
    <section class="view is-active" id="view-clients">

      <section class="gridCards">
        <article class="card kpi kpi-a">
          <div class="kpiLabel">Clientes</div>
          <div class="kpiValue" id="kpiClients">0</div>
          <div class="kpiHint">Total en base local</div>
        </article>
        <article class="card kpi kpi-b">
          <div class="kpiLabel">VIP</div>
          <div class="kpiValue" id="kpiVIP">0</div>
          <div class="kpiHint">Clientes marcados VIP</div>
        </article>
        <article class="card kpi kpi-c">
          <div class="kpiLabel">Ingresos (historial)</div>
          <div class="kpiValue" id="kpiRevenue">$0.00</div>
          <div class="kpiHint">Sumatoria de visitas</div>
        </article>
      </section>

      <section class="card section">
        <div class="sectionHead">
          <div class="sectionTitle">Búsqueda</div>
          <div class="rowBtns">
            <input class="input small" id="clientSearch" placeholder="Buscar por nombre, teléfono, tag..." />
          </div>
        </div>

        <div class="tableWrap">
          <table class="gridTable">
            <thead>
              <tr>
                <th>Cliente</th>
                <th>Contacto</th>
                <th>Estado</th>
                <th>Tags</th>
                <th>Última visita</th>
                <th>Total</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="clientsBody"></tbody>
          </table>
        </div>
        <div class="hint">Tip: “Abrir” entra al perfil del cliente para historial y seguimiento.</div>
      </section>

      <!-- PERFIL CLIENTE -->
      <section class="card section" id="clientProfile" style="display:none">
        <div class="sectionHead">
          <div>
            <div class="sectionTitle" id="pName">Cliente</div>
            <div class="muted" id="pMeta">—</div>
          </div>
          <div class="rowBtns">
            <button class="btn ghost" id="btnCloseProfile" type="button">Cerrar</button>
            <button class="btn" id="btnAddVisit" type="button">+ Visita</button>
          </div>
        </div>

        <section class="gridCards" style="grid-template-columns:repeat(2,1fr);margin-top:10px">
          <article class="card kpi kpi-b">
            <div class="kpiLabel">Última visita</div>
            <div class="kpiValue" id="pLastVisit">—</div>
            <div class="kpiHint">Fecha más reciente</div>
          </article>
          <article class="card kpi kpi-c">
            <div class="kpiLabel">Total (cliente)</div>
            <div class="kpiValue" id="pTotal">$0.00</div>
            <div class="kpiHint">Sumatoria de visitas</div>
          </article>
        </section>

        <div class="grid2" style="margin-top:12px">
          <div class="field">
            <label>Nombre</label>
            <input class="input" id="pNameInput" />
          </div>
          <div class="field">
            <label>Tel/Email</label>
            <input class="input" id="pContactInput" />
          </div>
          <div class="field">
            <label>Dirección</label>
            <input class="input" id="pAddrInput" />
          </div>
          <div class="field">
            <label>Estado</label>
            <select class="input" id="pStatusInput">
              <option>Prospecto</option>
              <option>Activo</option>
              <option>VIP</option>
              <option>Pausado</option>
            </select>
          </div>
          <div class="field">
            <label>Tags (coma)</label>
            <input class="input" id="pTagsInput" placeholder="mini split, mantenimiento, comercial" />
          </div>
          <div class="field">
            <label>Nota</label>
            <input class="input" id="pNoteInput" placeholder="Preferencias, acceso, detalles..." />
          </div>
        </div>

        <div class="rowBtns" style="margin-top:10px">
          <button class="btn" id="btnSaveClient" type="button">Guardar cambios</button>
          <button class="btn danger" id="btnDeleteClient" type="button">Borrar cliente</button>
        </div>

        <div class="sectionHead" style="margin-top:14px">
          <div class="sectionTitle">Historial</div>
          <div class="rowBtns">
            <input class="input small" id="visitSearch" placeholder="Buscar en historial..." />
          </div>
        </div>

        <div class="tableWrap">
          <table class="gridTable">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Servicio</th>
                <th>Monto</th>
                <th>Nota</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="visitsBody"></tbody>
          </table>
        </div>
      </section>

    </section>

    <!-- TIMELINE -->
    <section class="view" id="view-timeline">
      <div class="headerRow">
        <div class="titleBlock">
          <div class="h1">Timeline</div>
          <div class="muted">Últimos eventos/visitas de todos los clientes.</div>
        </div>
      </div>

      <section class="card section">
        <div class="sectionHead">
          <div class="sectionTitle">Actividad</div>
          <input class="input small" id="timelineSearch" placeholder="Buscar..." />
        </div>
        <div class="tableWrap">
          <table class="gridTable">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Cliente</th>
                <th>Servicio</th>
                <th>Monto</th>
                <th>Nota</th>
              </tr>
            </thead>
            <tbody id="timelineBody"></tbody>
          </table>
        </div>
      </section>
    </section>

    <!-- REPORTING -->
    <section class="view" id="view-reporting">
      <div class="headerRow">
        <div class="titleBlock">
          <div class="h1">Reporte</div>
          <div class="muted">KPIs rápidos por estado.</div>
        </div>
      </div>

      <section class="gridCards">
        <article class="card kpi kpi-a">
          <div class="kpiLabel">Prospectos</div>
          <div class="kpiValue" id="repPros">0</div>
          <div class="kpiHint">En pipeline</div>
        </article>
        <article class="card kpi kpi-b">
          <div class="kpiLabel">Activos</div>
          <div class="kpiValue" id="repAct">0</div>
          <div class="kpiHint">Operando</div>
        </article>
        <article class="card kpi kpi-c">
          <div class="kpiLabel">Pausados</div>
          <div class="kpiValue" id="repPau">0</div>
          <div class="kpiHint">Sin movimiento</div>
        </article>
      </section>

      <section class="card section">
        <div class="sectionHead">
          <div class="sectionTitle">Top clientes (por total)</div>
        </div>
        <div class="tableWrap">
          <table class="gridTable">
            <thead><tr><th>Cliente</th><th>Total</th><th>Última visita</th></tr></thead>
            <tbody id="topBody"></tbody>
          </table>
        </div>
      </section>
    </section>

    <!-- SETTINGS -->
    <section class="view" id="view-settings">
      <div class="headerRow">
        <div class="titleBlock">
          <div class="h1">Config</div>
          <div class="muted">Ajustes mínimos. El resto: ejecución.</div>
        </div>
      </div>

      <section class="card section">
        <div class="sectionHead">
          <div class="sectionTitle">Firebase Sync (Automático)</div>
          <div class="rowBtns">
            <button class="btn" id="btnLogin" type="button">Login Google</button>
            <button class="btn ghost" id="btnLogout" type="button">Logout</button>
          </div>
        </div>
        <div class="muted" id="fbStatus">Estado: offline</div>
        <div class="hint">
          Auto-sync usa <strong>/users/{uid}/oasis_crm/</strong>. No toca facturación ni otras apps.
        </div>
      </section>

      <section class="card section">
        <div class="sectionHead">
          <div class="sectionTitle">Oasis Hub</div>
        </div>
        <div class="muted">El botón flotante “⟵ Hub” se controla desde <strong>app.js</strong> (HUB_URL).</div>
      </section>

      <section class="card section">
        <div class="sectionHead">
          <div class="sectionTitle">Reset</div>
          <div class="rowBtns">
            <button class="btn danger" id="btnResetAll" type="button">Borrar todo (local)</button>
          </div>
        </div>
        <div class="hint">Esto elimina clientes y visitas de este navegador.</div>
      </section>
    </section>

  </main>

  <!-- Modal Cliente -->
  <div class="modal" id="clientModal" style="display:none">
    <div class="modalCard">
      <div class="modalHead">
        <div>
          <div class="modalTitle">Nuevo Cliente</div>
          <div class="modalHint">Rápido, limpio, sin drama.</div>
        </div>
        <button class="btn ghost" id="btnCloseModal" type="button">Cerrar</button>
      </div>

      <div class="modalBody">
        <div class="grid2">
          <div class="field"><label>Nombre</label><input class="input" id="mName" /></div>
          <div class="field"><label>Tel/Email</label><input class="input" id="mContact" /></div>
          <div class="field"><label>Dirección</label><input class="input" id="mAddr" /></div>
          <div class="field">
            <label>Estado</label>
            <select class="input" id="mStatus">
              <option>Prospecto</option>
              <option>Activo</option>
              <option>VIP</option>
              <option>Pausado</option>
            </select>
          </div>
          <div class="field"><label>Tags (coma)</label><input class="input" id="mTags" placeholder="mini split, mantenimiento" /></div>
          <div class="field"><label>Nota</label><input class="input" id="mNote" placeholder="Preferencias, acceso..." /></div>
        </div>

        <div class="rowBtns" style="margin-top:12px">
          <button class="btn" id="btnCreateClient" type="button">Crear</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Visita -->
  <div class="modal" id="visitModal" style="display:none">
    <div class="modalCard">
      <div class="modalHead">
        <div>
          <div class="modalTitle" id="visitModalTitle">Nueva Visita</div>
          <div class="modalHint">Servicio + monto + nota.</div>
        </div>
        <button class="btn ghost" id="btnCloseVisitModal" type="button">Cerrar</button>
      </div>

      <div class="modalBody">
        <div class="grid2">
          <div class="field"><label>Fecha</label><input class="input" id="vDate" type="date" /></div>
          <div class="field"><label>Monto</label><input class="input" id="vAmount" type="number" step="0.01" min="0" /></div>
          <div class="field"><label>Servicio</label><input class="input" id="vService" placeholder="Mantenimiento / Instalación..." /></div>
          <div class="field"><label>Nota</label><input class="input" id="vNote" placeholder="Detalles, piezas, garantía..." /></div>
        </div>

        <div class="rowBtns" style="margin-top:12px">
          <button class="btn" id="btnSaveVisit" type="button">Guardar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- HUB floating button -->
  <a class="hub-fab" id="hubBackBtn" href="#" title="Volver a Oasis Hub" aria-label="Volver a Oasis Hub">⟵ Hub</a>

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>

  <script src="app.js"></script>
</body>
</html>
